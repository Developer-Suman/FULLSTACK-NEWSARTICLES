name: Deploy to Local Computer

on:
  push:
    branches:
      - main  # or the branch you want to trigger this workflow

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Write SSH key to file
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" | Out-File -FilePath "C:\Users\suman\.ssh\id_rsa" -Encoding utf8
          icacls "C:\Users\suman\.ssh\id_rsa" /inheritance:r
          icacls "C:\Users\suman\.ssh\id_rsa" /grant:r "${env:USERNAME}:(R)"
        shell: pwsh

      - name: Deploy to Local Computer
        run: |
          rsync -avz --delete BackEnd/MASTER-PROJECT-IN-LAYERED-ARCHITECTURE-GENERIC-REPOSITORY/publish/ suman@192.168.1.64:/Test/
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Notify Success
        run: echo "Deployment successful! ðŸŽ‰"
